CVAULT-118: Optimize API Response Times and Add Request Caching
===============================================================

## Initial Analysis

### API Endpoints Identified:
1. `/api/consensus` - GET (SSE streaming), POST (batch analysis)
2. `/api/consensus-detailed` - GET, POST (detailed 4/5 consensus)
3. `/api/price` - GET (current asset price)
4. `/api/trading/execute` - POST (execute paper trade)
5. `/api/trading/close` - POST (close paper trade)
6. `/api/trading/history` - GET (trading history)
7. `/api/chatroom/stream` - GET (SSE streaming for debate)

### Bottlenecks Identified:
1. **AI Model API Calls** - 5 parallel calls to DeepSeek, Kimi, MiniMax, GLM, Gemini (1-3s each)
2. **Price Service** - CoinGecko API calls (external latency)
3. **Repeated Consensus Analysis** - Same asset queries trigger full AI analysis
4. **No Response Memoization** - Identical requests reprocess from scratch

### Caching Strategy Decisions:

#### 1. Price API (`/api/price`)
- **Strategy**: Next.js `unstable_cache` with 30s revalidation
- **Rationale**: Price data changes frequently but 30s TTL is acceptable for trading UI
- **Cache Key**: Asset symbol
- **Vercel Edge**: Cache at edge for global performance

#### 2. Consensus APIs (`/api/consensus`, `/api/consensus-detailed`)
- **Strategy**: Request memoization with short TTL (60s) for identical asset+context
- **Rationale**: AI responses are expensive but can be cached briefly for identical queries
- **Exclusions**: SSE streaming endpoint remains real-time (no caching)
- **Cache Key**: Asset + Context hash
- **Invalidation**: Time-based (TTL), no manual invalidation needed

#### 3. Trading History (`/api/trading/history`)
- **Strategy**: Short-term cache (5s) with dynamic = 'force-dynamic' preserved for mutations
- **Rationale**: History changes frequently with trades, but brief cache reduces DB load

#### 4. Chatroom Stream (`/api/chatroom/stream`)
- **Strategy**: NO CACHING - SSE streaming requires real-time updates
- **Rationale**: Dynamic debate content must not be cached

### Implementation Plan:
1. Create shared cache utilities in `/src/lib/cache.ts`
2. Update `/api/price/route.ts` with edge caching
3. Update `/api/consensus-detailed/route.ts` with memoization
4. Update `/api/trading/history/route.ts` with short cache
5. Add cache headers to all responses for CDN/Vercel optimization
6. Document caching strategy in code comments

## Work Log:

